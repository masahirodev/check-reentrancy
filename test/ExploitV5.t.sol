// SPDX-License-Identifier: MIT
pragma solidity ^0.8.18;

import "./helper/TestHelpers.t.sol";
import "contracts/TokenContractV5.sol";
import "contracts/AttackContractV5.sol";

// forge test --match-contract ExploitV5 --match-test testExploit

contract ExploitV5 is TestHelpers {
    TokenContract public tokenContract;
    AttackContract public attackContract;

    function setUp() public {
        tokenContract = new TokenContract();
        attackContract = new AttackContract(address(tokenContract));
    }

    function testMint() public onlyOwner {
        tokenContract.mint();
        assertEq(tokenContract.totalSupply(), 1);
    }

    function testMultiMint() public onlyOwner {
        tokenContract.mint();

        vm.expectRevert("Already minted!");
        tokenContract.mint();
        assertEq(tokenContract.totalSupply(), 1);
    }

    function testExploit() public {
        attackContract.exploit();
        assertGt(tokenContract.balanceOf(address(attackContract)), 1);
        console2.logUint(tokenContract.balanceOf(address(attackContract)));
    }
}
